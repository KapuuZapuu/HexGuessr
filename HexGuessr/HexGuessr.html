<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
        rel="stylesheet" />
    <title>HexGuessr</title>
    <style>
        /* Define a shadow variable for light mode */
        :root {
            --icon-shadow: #c8c8c8;  /* softer on light backgrounds */
        }

        .layout-container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
            padding: 20px 30px;
        }

        .game-header {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 30px;
            padding: 20px 0;
            width: 100%;
        }
        
        .game-container {
            padding-top: 30px 0;
            width: 100%;
        }

        /* Top-right container for the two buttons */
        .top-controls {
            grid-column: 3;
            position: static;
            top: auto;
            right: auto;
            left: auto;
            display: flex;
            gap: 12px;
            z-index: 1000;
            align-items: center;
            justify-self: end;    /* make sure everything hugs the right edge */
            margin: 0;
        }

        .mode-container {
            grid-column: 1;
            position: static;
            top: auto;             /* same vertical as your old author credit */
            left: auto;            /* same horizontal offset */
            right: auto;
            display: flex;
            align-items: center;
            gap: 15px;             /* matches your other flex gaps */
            padding: 15px;         /* same “cushion” as your color picker */
            background: rgba(143, 143, 143, 0.1);
            z-index: 1001;
            margin: 0;
        }
        /* Button styling, same aesthetic as your "click to reveal" square */
        .mode-btn {
            width: 130px;             /* wide and rectangular */
            height: 50px;
            background: #f9f9f9;        /* same blank canvas */
            border: none;
            cursor: pointer;

            /* block-pixel look */
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: black;
            text-shadow: 2px 2px 0 var(--icon-shadow);

            /* center the label */
            display: flex;
            align-items: center;
            justify-content: center;

            /* same hover-lift you already use */
            transition: transform 0.2s ease;
        }
        .mode-btn:hover {
            transform: translateY(-6px);
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: transform 0.2s ease;
        }

        .icon-btn:hover {
            transform: translateY(-6px);
        }

        .icon-btn img {
            width: 45px;
            height: 45px;
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            filter: drop-shadow(4px 4px 0 var(--icon-shadow)); /* subtle shadow for depth */
        }

        /* Light mode style */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: black;
            --icon-shadow: #c8c8c8;
        }

        /* Dark-mode overrides */
        body.dark {
          background: #262626;
          color: white;
          --icon-shadow: #101010;  /* crisper on dark backgrounds */
        }
        body.dark .color-display {           
            color: #eee;                  /* make sure your placeholder text is still readable */
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
            border-color: #eee
        }
        body.dark .color-display.hidden {
            /* override the always‑black you had before */
            background: #2e2e2e !important;
        }
        body.dark .color-display.game-ended {
            /* reuse the dark‑mode text style */
            color: #eee;
            text-shadow:
                -1px -1px 0 #000000,
                1px -1px 0 #000000,
                -1px  1px 0 #000000,
                1px  1px 0 #000000;
        }
        body:not(.dark) .color-display.game-ended {
            /* reuse the dark‑mode text style */
            color: #eee;
            text-shadow:
                -1px -1px 0 #000000,
                1px -1px 0 #000000,
                -1px  1px 0 #000000,
                1px  1px 0 #000000;
        }
        body.dark .game-container {
          background: #000000;
        }
        body.dark .hex-input {
          background: rgba(0, 0, 0, 0.1);
          color: #000000;
        }
        body.dark .color-preview {
          border-color: #ffffff;
        }
        body.dark .submit-btn {
          background: #388e3c;
        }
        body.dark .submit-btn:hover {
          background: #2e7d32;
        }
        body.dark .restart-btn {
          background: #1565c0;
        }
        body.dark .restart-btn:hover {
          background: #0d47a1;
        }
        body.dark .timer-bar {
            background: rgba(255,255,255,0.1);
        }
        body.dark .timer-fill {
            background: #81C784;       /* lighter green, for example */
        }
        body.dark .color-picker-section {
            background: #222 !important;
        }
        body.dark .color-canvas {
            border-color: #ffffff
        }
        body.dark .hue-slider {
            border-color: #ffffff;
        }
        body.dark .color-picker-section h3 {
            color: #eee !important;
        }
        body.dark .selected-color-info {
            color: #eee !important;
        }
        body.dark .custom-color-picker {
            background: #1d1d1d !important;
        }
        body.dark .color-picker-title {
            color: #eee !important;
        }
        body.dark .hex-display {
            color: #eee !important;
        }
        body.dark .hex-input-field {
            color: #fff;
        }
        body.dark .hex-input-container {
            background: #2e2e2e;
        }
        body.dark .hex-prefix {
            color: #fff;
        }

        .ascii-title {
            /* 1) Monospace ensures each character is exactly the same width */
            font-family: monospace;
            /* 2) Preserve every space and line‐break exactly as you type them */
            white-space: pre;
            /* 3) Prevent it from wrapping mid‑line */
            overflow-x: auto;
            /* Optional styling to match your theme */
            color: inherit;
            text-align: center;
            margin: 0;
            grid-column: 2;
            justify-self: center;
            transform: translateY(10px);
            padding: 30px 20px 20px 20px;
            line-height: 1em;      /* tighten the lines if you like */
            font-size: 1em;        /* adjust so it fits */
            position: relative;
            max-width: fit-content;
            overflow: visible;
        }

        /* animate every character */
        .ascii-title span {
            display: inline-block;                      /* so animation-delay works per char */
            animation: wave 6s linear infinite;         /* 6s for a full cycle */
            animation-delay: calc(var(--col) * 0.1s);   /* stagger by 0.1s per character */
            transition: transform 0.2s ease;
        }

        .ascii-title span.hover-group {
            transform: translateY(-8px);                /* tweak how high it jumps */
        }

        /* “paused” class will freeze all ascii‑title spans */
        .paused .ascii-title span {
            animation-play-state: paused !important;
        }

        /* cycle through hues for title */
        @keyframes wave {
            0%   { color: hsl(   0, 100%, 50%); }
            16%  { color: hsl(  60, 100%, 50%); }
            33%  { color: hsl( 120, 100%, 50%); }
            50%  { color: hsl( 180, 100%, 50%); }
            66%  { color: hsl( 240, 100%, 50%); }
            83%  { color: hsl( 300, 100%, 50%); }
            100% { color: hsl( 360, 100%, 50%); }
        }

        .color-display {
            width: 200px;
            height: 200px;
            margin: 20px 0;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow)); /* same shadow as icons */
            justify-content: center;
            text-align: center;
            font-size: 18px;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 3px 3px 0 var(--icon-shadow);
            color: black;
            margin: 0;
        }

        .color-display:hover {
            transform: translateY(-6px);
        }

        .color-display.hidden {
            background: #f9f9f9 !important;
        }

        .game-info {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
        }

        .input-section {
            text-align: center;
            margin: 20px 0;
        }

        .hex-input {
            font-size: 20px;
            padding: 12px;
            border: none;
            width: 200px;
            text-align: center;
            text-transform: uppercase;
            background: #ffffff;
            color: #333;
        }

        .submit-btn {
            font-size: 18px;
            padding: 12px 24px;
            margin-left: 10px;
            border: none;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .submit-btn:hover {
            background: #45a049;
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .guesses-container {
            margin: 20px 0;
        }

        .guess-row {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            gap: 5px;
        }

        .guess-char {
            width: 40px;
            height: 40px;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.1);
        }

        .correct {
            background: #4CAF50 !important;
            border-color: #4CAF50;
        }

        .close {
            background: #FFC107 !important;
            border-color: #FFC107;
            color: #333;
        }

        .wrong {
            background: #f44336 !important;
            border-color: #f44336;
        }

        .custom-color-picker {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(143, 143, 143, 0.1);
            font-family: 'Press Start 2P', cursive;
            position: relative;
        }

        .color-picker-main {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .color-canvas {
            width: 200px;
            height: 200px;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
            cursor: pointer;
            position: relative;
            background: linear-gradient(to right, #fff, #f00);
            flex-shrink: 0;
        }

        .color-canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent, #000);
        }

        .canvas-cursor {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.3);
        }

        .hue-slider {
            width: 20px;
            height: 200px;
            background: linear-gradient(to bottom, 
                #f00 0%, #ff0 16.66%, #0f0 33.33%, 
                #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100%);
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
        }

        .hue-cursor {
            position: absolute;
            width: 20px;
            height: 16px;
            border: 2px solid white;
            transform: translateY(-50%);
            left: 0px;
            pointer-events: none;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.3);
        }

        .color-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .color-preview {
            width: 160px;
            height: 100px;
            margin: 0;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
        }

        .hex-input-container {
            display: flex;
            align-items: center;
            width: 160px;
            height: 32px;
            background: #f9f9f9;
            border: none;
            position: relative;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
        }

        .hex-prefix {
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: #000000;
            padding-left: 8px;
            user-select: none;
            pointer-events: none;
            flex-shrink: 0;
        }

        .hex-input-field {
            font-size: 12px;
            padding: 8px 4px;
            border: none;
            flex: 1;
            background: transparent;
            text-transform: uppercase;
            color: #000000;
            font-family: 'Press Start 2P', cursive;
            outline: none;
            padding-right: 32px;
        }

        .hex-copy-btn {
            background: none;
            border: none;
            padding: 4px 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            flex-shrink: 0;
            right: 4px;
            position: absolute;
        }

        .hex-copy-btn:hover {
            transform: translateY(-2px);
        }

        .hex-copy-btn img {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* style the new copy‐icon button */
        #copyBtn {
            background: none;
            border: none;
            padding: 2px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        #copyBtn:hover {
            transform: translateY(-3px);
        }

        /* size & shadow the copy icon to match everything else */
        #copyIcon {
            width: 20px;
            height: 20px;
            image-rendering: pixelated;
            filter: drop-shadow(0 0 0 transparent);
            image-rendering: crisp-edges;
        }

        .color-game-section {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .game-over {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
        }

        .restart-btn {
            font-size: 18px;
            padding: 12px 24px;
            border: none;
            background: #2196F3;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }

        .restart-btn:hover {
            background: #1976D2;
        }

        .timer { /* Removeable? */
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            font-weight: bold;
        }
        .timer-bar {
            width: 200px;
            height: 8px;
            background: rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 10px auto;
        }
        /* the animated “fill” */
        .timer-fill {
            width: 100%;              /* starts full */
            height: 100%;
            background: #4CAF50;       /* or pick any accent color */
            transition: width linear;  /* you’ll set duration in JS */
        }
    </style>
</head>
<body>
    <div class="layout-container">
        <header class="game-header">
            <!-- mode selector buttons -->
            <div class="mode-container">
                <button class="mode-btn">Daily</button>
                <button class="mode-btn">Unlimited</button>
            </div>

            <pre class="ascii-title">
██╗  ██╗███████╗██╗  ██╗ ██████╗ ██╗   ██╗███████╗███████╗███████╗██████╗ 
██║  ██║██╔════╝╚██╗██╔╝██╔════╝ ██║   ██║██╔════╝██╔════╝██╔════╝██╔══██╗
███████║█████╗   ╚███╔╝ ██║  ███╗██║   ██║█████╗  ███████╗███████╗██████╔╝
██╔══██║██╔══╝   ██╔██╗ ██║   ██║██║   ██║██╔══╝  ╚════██║╚════██║██╔══██╗
██║  ██║███████╗██╔╝ ██╗╚██████╔╝╚██████╔╝███████╗███████║███████║██║  ██║
╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚══════╝╚═╝  ╚═╝
            </pre>

            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const pre   = document.querySelector(".ascii-title");
                    const lines = pre.textContent.split("\n");
                    pre.innerHTML = "";           // clear out the raw ASCII

                    const letterWidths = [8, 8, 8, 9, 9, 8, 8, 8, 8];  // <- manual widths for each ASCII letter 
                                                                // (first char is for the spacing before the "H")
                    // build cumulative edges
                    const boundaries = letterWidths.reduce((acc, w) => {
                        acc.push(acc[acc.length-1] + w);
                        return acc;
                    }, [0]);

                    lines.forEach((line, row) => {
                        Array.from(line).forEach((ch, col) => {
                            const span = document.createElement("span");
                            span.textContent = ch;
                            // store only the column number, not a running index
                            span.style.setProperty("--col", col);
                            // compute which ASCII‑letter this char belongs to
                            const letterIndex = boundaries.findIndex((b, i) =>
                                col >= b && col < (boundaries[i+1] || Infinity)
                            );
                            span.dataset.letter = letterIndex;
                            pre.appendChild(span);
                        });
                        // re–insert a newline so your <pre> stays multi‑line
                        if (row < lines.length - 1) {
                            pre.appendChild(document.createTextNode("\n"));
                        }
                    });

                    document.querySelectorAll(".ascii-title span").forEach(span => {
                        span.addEventListener("mouseenter", () => {
                            const idx = span.dataset.letter;
                            document
                                .querySelectorAll(`.ascii-title span[data-letter="${idx}"]`)
                                .forEach(s => s.classList.add("hover-group"));
                        });
                        span.addEventListener("mouseleave", () => {
                            const idx = span.dataset.letter;
                            document
                                .querySelectorAll(`.ascii-title span[data-letter="${idx}"]`)
                                .forEach(s => s.classList.remove("hover-group"));
                        });
                    });
                });
            </script>

            <div class="top-controls">

                <!-- Help / Instructions -->
                <button id="infoButton"        class="icon-btn" aria-label="Show instructions">
                    <img 
                        id="infoIcon"
                        src="question-mark-light.png" 
                        data-light="question-mark-light.png" 
                        data-dark="question-mark-dark.png"
                        alt="Help">
                </button>

                <!-- Stats (if you have a stats panel) -->
                <button id="statsButton"       class="icon-btn" aria-label="Show stats">
                    <img
                        id="statsIcon"
                        src="stats-light.png"
                        data-light="stats-light.png"
                        data-dark="stats-dark.png"
                        alt="Stats">
                </button>

                <!-- Animation toggle -->
                <button id="toggleAnimations" class="icon-btn" aria-label="Pause animations">
                    <img
                        id="animIcon"
                        src="animation-suspend-light.png"
                        data-light="animation-suspend-light.png"
                        data-dark="animation-suspend-dark.png"
                        alt="Toggle animations">
                </button>

                <!-- Dark‑mode toggle -->
                <button id="darkModeToggle"   class="icon-btn" aria-label="Toggle dark mode">
                    <img
                        id="darkModeIcon"
                        src="dark-mode-light.png"
                        data-light="dark-mode-light.png"
                        data-dark="dark-mode-dark.png"
                        alt="Dark mode">
                </button>
            </div>
        </header>

        <div class="game-container">   
            <div class="color-game-section">
                <div class="custom-color-picker">
                    <div class="color-display hidden" id="colorDisplay">
                        Click to reveal color!
                    </div>
                    
                    <div class="color-picker-main">                
                        <div class="color-canvas" id="colorCanvas">
                            <div class="canvas-cursor" id="canvasCursor"></div>
                        </div>
                        
                        <div class="hue-slider" id="hueSlider">
                            <div class="hue-cursor" id="hueCursor"></div>
                        </div>
                        
                        <div class="color-controls">
                            <div class="color-preview" id="colorPreview"></div>
                            
                            <div class="hex-input-container">
                                <span class="hex-prefix">#</span>
                                <input type="text" id="hexInputField" class="hex-input-field" value="FF5733" maxlength="6">
                                <button id="copyBtn" class="hex-copy-btn" aria-label="Copy hex code">
                                    <img
                                        id="copyIcon"
                                        src="copy-light.png"
                                        data-light="copy-light.png"
                                        data-dark="copy-dark.png"
                                        alt="Copy"
                                    />
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timer-bar" id="timerBar" style="display:none;">
                        <div class="timer-fill" id="timerFill"></div>
                    </div>
                </div>
            </div>
            
            <div class="game-info">
                <div>Attempt: <span id="currentAttempt">1</span> / 6</div>
                <div>Click the square above to see the target color!</div>
            </div>

            <div class="input-section">
                <input type="text" id="hexInput" class="hex-input" placeholder="Enter hex (e.g., FF5733)" maxlength="6">
                <button id="submitBtn" class="submit-btn">Submit Guess</button>
            </div>

            <div class="guesses-container" id="guessesContainer"></div>

            <div id="gameOver" class="game-over" style="display: none;">
                <h2 id="gameResult"></h2>
                <p id="correctAnswer"></p>
                <button id="restartBtn" class="restart-btn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        class HexColorWordle {
            constructor() {
                this.targetColor = this.generateRandomColor();
                this.currentAttempt = 1;
                this.maxAttempts = 6;
                this.gameOver = false;
                this.colorVisible = false;
                this.baseDuration = 1000; // 1 second for first attempt
                
                this.initializeElements();
                this.setupEventListeners();
                this.updateColorPicker();

                // Info button listener
                this.infoBtn = document.getElementById('infoButton');
                this.infoBtn.addEventListener('click', () => {
                  alert(
                    '🎨 Hex Color Wordle Instructions:\n\n' +
                    '1) Click the square to briefly reveal the target color.\n' +
                    '2) Enter your 6‑digit HEX guess and press Submit.\n' +
                    '3) Green = correct digit, Yellow = off by 1, Red = wrong.\n' +
                    '4) You have 6 attempts – good luck!'
                  );
                });
            }

            initializeElements() {
                this.colorDisplay = document.getElementById('colorDisplay');
                this.hexInput = document.getElementById('hexInput');
                this.submitBtn = document.getElementById('submitBtn');
                this.currentAttemptSpan = document.getElementById('currentAttempt');
                this.guessesContainer = document.getElementById('guessesContainer');
                this.gameOverDiv = document.getElementById('gameOver');
                this.gameResult = document.getElementById('gameResult');
                this.correctAnswer = document.getElementById('correctAnswer');
                this.restartBtn = document.getElementById('restartBtn');
                this.timer = document.getElementById('timer'); // Removeable?
                this.timerBar  = document.getElementById('timerBar');
                this.timerFill = document.getElementById('timerFill');
                
                // Custom color picker elements
                this.colorCanvas = document.getElementById('colorCanvas');
                this.canvasCursor = document.getElementById('canvasCursor');
                this.hueSlider = document.getElementById('hueSlider');
                this.hueCursor = document.getElementById('hueCursor');
                this.colorPreview = document.getElementById('colorPreview');
                this.hexInputField = document.getElementById('hexInputField');
                this.copyBtn = document.getElementById('copyBtn');
            }

            setupEventListeners() {
                this.colorDisplay.addEventListener('click', () => this.showColor());
                this.submitBtn.addEventListener('click', () => this.submitGuess());
                this.hexInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.submitGuess();
                });
                this.hexInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^0-9A-Fa-f]/g, '').toUpperCase();
                });
                this.restartBtn.addEventListener('click', () => this.restartGame());
                
                // Custom color picker event listeners
                this.setupColorPickerListeners();
            }
            
            setupColorPickerListeners() {
                // Canvas click/drag
                let isDraggingCanvas = false;
                this.colorCanvas.addEventListener('mousedown', (e) => {
                    isDraggingCanvas = true;
                    this.updateCanvasPosition(e);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDraggingCanvas) {
                        this.updateCanvasPosition(e);
                    }
                    if (isDraggingHue) {
                        this.updateHuePosition(e);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDraggingCanvas = false;
                    isDraggingHue = false;
                });
                
                // Hue slider click/drag
                let isDraggingHue = false;
                this.hueSlider.addEventListener('mousedown', (e) => {
                    isDraggingHue = true;
                    this.updateHuePosition(e);
                });

                // 1) Block bad keys _before_ they ever enter the field
                this.hexInputField.addEventListener("keydown", e => {
                    // allow navigation / copy-paste etc.
                    if (e.metaKey || e.ctrlKey || e.altKey) return;
                    // only block single‐char keys that aren’t 0–9 or A–F
                    if (e.key.length === 1 && !/^[0-9A-Fa-f]$/.test(e.key)) {
                        e.preventDefault();
                    }
                });

                // Hex input field
                this.hexInputField.addEventListener('input', (e) => {
                    const input = e.target;
                    // save where the caret was
                    const pos = input.selectionStart;
                    // filter + uppercase
                    const filtered = input.value
                        .replace(/[^0-9A-Fa-f]/g, '')
                        .toUpperCase();
                    input.value = filtered;
                    // put the caret back where it was
                    input.setSelectionRange(pos, pos);

                    if (filtered.length === 6) {
                        this.updateFromHex(filtered);
                    }
                });
                
                // Copy button
                this.copyBtn.addEventListener('click', () => {
                    const hexValue = '#' + this.hexInputField.value;
                    navigator.clipboard.writeText(hexValue).then(() => {
                        // Create a temporary tooltip-like feedback
                        const feedback = document.createElement('div');
                        feedback.textContent = 'Copied!';
                        feedback.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: #4CAF50;
                            color: white;
                            padding: 8px 12px;
                            font-size: 10px;
                            font-family: 'Press Start 2P', cursive;
                            pointer-events: none;
                            z-index: 1000;
                            filter: drop-shadow(2px 2px 0 #2e7d32);
                        `;
                        document.body.appendChild(feedback);
                        setTimeout(() => {
                            if (feedback.parentNode) {
                                feedback.parentNode.removeChild(feedback);
                            }
                        }, 1000);
                    }).catch(() => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = hexValue;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        // Create a temporary tooltip-like feedback for fallback too
                        const feedback = document.createElement('div');
                        feedback.textContent = 'Copied!';
                        feedback.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: #4CAF50;
                            color: white;
                            padding: 8px 12px;
                            font-size: 10px;
                            font-family: 'Press Start 2P', cursive;
                            pointer-events: none;
                            z-index: 1000;
                            filter: drop-shadow(2px 2px 0 #2e7d32);
                        `;
                        document.body.appendChild(feedback);
                        setTimeout(() => {
                            if (feedback.parentNode) {
                                feedback.parentNode.removeChild(feedback);
                            }
                        }, 1000);
                    });
                });
                
                // Initialize color picker
                this.currentHue = 0;
                this.currentSaturation = 1;
                this.currentValue = 1;
                this.updateColorPicker();
            }
            
            updateCanvasPosition(e) {
                const rect = this.colorCanvas.getBoundingClientRect();
                const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));
                const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
                
                this.canvasCursor.style.left = x + 'px';
                this.canvasCursor.style.top = y + 'px';
                
                // Calculate saturation and brightness (value)
                this.currentSaturation = x / rect.width;
                this.currentValue = 1 - (y / rect.height);
                
                this.updateColorFromHSV();
            }
            
            updateHuePosition(e) {
                const rect = this.hueSlider.getBoundingClientRect();
                const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
                
                this.hueCursor.style.top = y + 'px';
                
                // Calculate hue (0-360)
                this.currentHue = (y / rect.height) * 360;
                
                // Update canvas background
                const hueColor = `hsl(${this.currentHue}, 100%, 50%)`;
                this.colorCanvas.style.background = `linear-gradient(to right, #fff, ${hueColor})`;
                
                this.updateColorFromHSV();
            }
            
            updateColorFromHSV() {
                // Convert HSV to RGB
                const h = this.currentHue / 360;
                const s = this.currentSaturation;
                const v = this.currentValue;
                
                const c = v * s;
                const x = c * (1 - Math.abs((h * 6) % 2 - 1));
                const m = v - c;
                
                let r, g, b;
                if (h < 1/6) {
                    r = c; g = x; b = 0;
                } else if (h < 2/6) {
                    r = x; g = c; b = 0;
                } else if (h < 3/6) {
                    r = 0; g = c; b = x;
                } else if (h < 4/6) {
                    r = 0; g = x; b = c;
                } else if (h < 5/6) {
                    r = x; g = 0; b = c;
                } else {
                    r = c; g = 0; b = x;
                }
                
                r = (r + m);
                g = (g + m);
                b = (b + m);
                
                // Convert to 0-255 range
                r = Math.round(r * 255);
                g = Math.round(g * 255);
                b = Math.round(b * 255);
                
                // Convert to hex
                const hex = ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
                
                // Update UI
                this.colorPreview.style.backgroundColor = `#${hex}`;
                this.hexInputField.value = hex;
            }
            
            updateFromHex(hex) {
                // Convert hex to RGB
                const r = parseInt(hex.substr(0, 2), 16) / 255;
                const g = parseInt(hex.substr(2, 2), 16) / 255;
                const b = parseInt(hex.substr(4, 2), 16) / 255;
                
                // Convert RGB to HSV
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const delta = max - min;
                
                let h, s, v = max;
                
                if (delta === 0) {
                    h = 0;
                    s = 0;
                } else {
                    s = delta / max;
                    
                    switch (max) {
                        case r: h = (g - b) / delta + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / delta + 2; break;
                        case b: h = (r - g) / delta + 4; break;
                    }
                    h /= 6;
                }
                
                // Update internal state
                this.currentHue = h * 360;
                this.currentSaturation = s;
                this.currentValue = v;
                
                // Update UI positions
                const huePos = (this.currentHue / 360) * this.hueSlider.offsetHeight;
                this.hueCursor.style.top = huePos + 'px';
                
                const canvasX = this.currentSaturation * this.colorCanvas.offsetWidth;
                const canvasY = (1 - this.currentValue) * this.colorCanvas.offsetHeight;
                this.canvasCursor.style.left = canvasX + 'px';
                this.canvasCursor.style.top = canvasY + 'px';
                
                // Update canvas background
                const hueColor = `hsl(${this.currentHue}, 100%, 50%)`;
                this.colorCanvas.style.background = `linear-gradient(to right, #fff, ${hueColor})`;
                
                // Update preview
                this.colorPreview.style.backgroundColor = `#${hex}`;
            }

            generateRandomColor() {
                return Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0').toUpperCase();
            }

            showColor() {
                if (this.colorVisible || this.gameOver) return;
                
                this.colorVisible = true;
                this.colorDisplay.style.background = `#${this.targetColor}`;
                this.colorDisplay.classList.remove('hidden');
                this.colorDisplay.textContent = '';
                
                // Calculate duration: increases with each attempt
                const duration = this.baseDuration + (this.currentAttempt - 1) * 500;
                
                this.startTimer(duration);
                
                setTimeout(() => {
                    if (!this.gameOver) {
                        this.colorDisplay.classList.add('hidden');
                        this.colorDisplay.textContent = 'Click to reveal color!';
                        this.colorVisible = false;
                    }
                }, duration);
            }

            startTimer(duration) {
                // hide any old text‑timer
                this.timer && (this.timer.textContent = '');

                // show & animate the bar
                this.timerBar.style.display = 'block';
                // set the CSS transition to match your duration
                this.timerFill.style.transition = `width ${duration}ms linear`;
                // trigger the shrink to 0%
                // (must be in next tick so transition applies)
                requestAnimationFrame(() => {
                    this.timerFill.style.width = '0%';
                });

                // after time's up, reset
                setTimeout(() => {
                    this.timerBar.style.display = 'none';
                    // restore for next round
                    this.timerFill.style.transition = '';
                    this.timerFill.style.width = '100%';
                }, duration);
            }

            submitGuess() {
                if (this.gameOver) return;
                
                const guess = this.hexInput.value.trim().toUpperCase();
                
                if (guess.length !== 6 || !/^[0-9A-F]{6}$/.test(guess)) {
                    alert('Please enter a valid 6-digit hex color (0-9, A-F)');
                    return;
                }

                this.processGuess(guess);
                this.hexInput.value = '';
                
                if (guess === this.targetColor) {
                    this.endGame(true);
                } else if (this.currentAttempt >= this.maxAttempts) {
                    this.endGame(false);
                } else {
                    this.currentAttempt++;
                    this.currentAttemptSpan.textContent = this.currentAttempt;
                }
            }

            processGuess(guess) {
                const guessRow = document.createElement('div');
                guessRow.className = 'guess-row';
                
                for (let i = 0; i < 6; i++) {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'guess-char';
                    charDiv.textContent = guess[i];
                    
                    if (guess[i] === this.targetColor[i]) {
                        charDiv.classList.add('correct');
                    } else if (this.isClose(guess[i], this.targetColor[i])) {
                        charDiv.classList.add('close');
                    } else {
                        charDiv.classList.add('wrong');
                    }
                    
                    guessRow.appendChild(charDiv);
                }
                
                this.guessesContainer.appendChild(guessRow);
            }

            isClose(guessChar, targetChar) {
                const guessValue = parseInt(guessChar, 16);
                const targetValue = parseInt(targetChar, 16);
                return Math.abs(guessValue - targetValue) <= 1;
            }

            endGame(won) {
                this.gameOver = true;
                this.colorDisplay.style.background = `#${this.targetColor}`;
                this.colorDisplay.classList.remove('hidden');
                this.colorDisplay.textContent = `#${this.targetColor}`;
                this.colorDisplay.classList.add('game-ended');
                this.timer.textContent = '';
                
                this.gameResult.textContent = won ? '🎉 Congratulations! You won!' : '😔 Game Over!';
                this.correctAnswer.textContent = `The correct color was: #${this.targetColor}`;
                this.gameOverDiv.style.display = 'block';
                
                this.submitBtn.disabled = true;
            }

            updateColorPicker() {
                // Initialize with default color
                this.updateFromHex('FF5733');
            }

            restartGame() {
                this.targetColor = this.generateRandomColor();
                this.currentAttempt = 1;
                this.gameOver = false;
                this.colorVisible = false;
                
                this.colorDisplay.classList.add('hidden');
                this.colorDisplay.textContent = 'Click to reveal color!';
                this.currentAttemptSpan.textContent = '1';
                this.guessesContainer.innerHTML = '';
                this.gameOverDiv.style.display = 'none';
                this.submitBtn.disabled = false;
                this.hexInput.value = '';
                this.timer.textContent = '';
                this.colorDisplay.classList.remove('game-ended');
            }
        }

        // Start the game when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            // 1) Start the game
            new HexColorWordle();

            // 2) Cache your icon <img> elements
            const infoIcon     = document.getElementById("infoIcon");
            const statsIcon    = document.getElementById("statsIcon");
            const animIcon     = document.getElementById("animIcon");
            const darkModeIcon = document.getElementById("darkModeIcon");
            const darkModeBtn  = document.getElementById("darkModeToggle");
            const copyIcon     = document.getElementById("copyIcon");

            // 3) Helper to swap src between data-light / data-dark
            function updateIconTheme(img, isDark) {
                img.src = isDark ? img.dataset.light : img.dataset.dark;
            }

            // 4) Refresh all icons at once
            function refreshIcons(isDark) {
                [infoIcon, statsIcon, animIcon, darkModeIcon, copyIcon]
                .forEach(img => updateIconTheme(img, isDark));
            }

            // 5) Wire up the dark‑mode button to also swap icons
            darkModeBtn.addEventListener("click", () => {
                const isDark = document.body.classList.toggle("dark");
                // swap the moon/sun icon itself
                updateIconTheme(darkModeIcon, isDark);
                // refresh the rest
                refreshIcons(isDark);
                // update its aria‐label
                darkModeBtn.setAttribute(
                    "aria-label",
                    isDark ? "Switch to light mode" : "Switch to dark mode"
                );
            });

            // 6) Wire up the info/stats buttons to swap icons
            const toggleAnimationsBtn = document.getElementById("toggleAnimations");

            toggleAnimationsBtn.addEventListener("click", () => {
                const isPaused = document.body.classList.toggle("paused");
                toggleAnimationsBtn.setAttribute(
                    "aria-label",
                    isPaused ? "Resume animations" : "Pause animations"
                );
            });


            // 7) Initialize to the correct theme on load
            refreshIcons(document.body.classList.contains("dark"));
        });
    </script>
</body>
</html>
