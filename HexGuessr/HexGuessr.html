<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
        rel="stylesheet" />
    <title>HexGuessr</title>
    <style>
        /* Define a shadow variable for light mode */
        :root {
            --icon-shadow: #c8c8c8;  /* softer on light backgrounds */
            --icon-color: #000000;
            --icon-color-hover: #555555;
        }

        .layout-container {
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
            padding: 5px 30px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            width: 100%;
        }
        
        .game-container {
            padding-top: 30px 0;
            width: 100%;
        }

        /* Top-right container for the two buttons */
        .top-controls {
            position: absolute;
            right: 5px;
            transform: none;
            display: flex;
            gap: 12px;
            z-index: 1000;
            align-items: center;
            margin: 0;
        }

        .mode-container {
            position: absolute;
            left: 5px;
            transform: none;
            display: flex;
            align-items: center;
            gap: 10px;             /* matches your other flex gaps */
            padding: 10px;         /* same "cushion" as your color picker */
            background: rgba(143, 143, 143, 0.1);
            margin: 0;
        }
        /* Button styling, same aesthetic as your "click to reveal" square */
        .mode-btn {
            width: 130px;             /* wide and rectangular */
            height: 40px;
            background: #f9f9f9;        /* same blank canvas */
            border: none;
            cursor: pointer;

            /* block-pixel look */
            filter: drop-shadow(4px 4px 0 var(--icon-shadow));
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: black;

            /* center the label */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mode-btn:hover {
            background: #f1f1f1
        }
        body.dark .mode-container {
            background: #1d1d1d;
        }
        body.dark .mode-btn {
            background: #2e2e2e;
            color: #ffffff;
        }
        body.dark .mode-btn:hover {
            background: #373737
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            filter: drop-shadow(4px 4px 0 var(--icon-shadow));
        }    
        .icon {
            width: 45px;
            height: 45px;
            display: block;
            fill: currentColor;
            color: var(--icon-color);
            shape-rendering: crispEdges;
        }
        .icon--sm {
            width: 20px;
            height: 20px;
        }
        .icon-btn:hover .icon {
            color: var(--icon-color-hover);
        }

        /* Light mode style */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: black;
            --icon-shadow: #c8c8c8;
        }
        /* Dark-mode overrides */
        body.dark {
            background: #262626;
            color: white;
            --icon-shadow: #101010;  /* crisper on dark backgrounds */
            --icon-color: #fff;
            --icon-color-hover: #c8c8c8;
        }

        body.dark .game-container {
          background: none;
        }
        body.dark .hex-input {
          background: rgba(0, 0, 0, 0.1);
          color: #000000;
        }
        body.dark .color-preview {
          border-color: #ffffff;
        }
        body.dark .restart-btn {
          background: #1565c0;
        }
        body.dark .timer-bar {
            background: #1d1d1d;
        }
        body.dark .timer-fill {
            background: #ffffff;
        }
        body.dark .timer-text {
            color: #000000;
        }
        body.dark .color-picker-section {
            background: #222 !important;
        }
        body.dark .color-canvas {
            border-color: #ffffff
        }
        body.dark .hue-slider {
            border-color: #ffffff;
        }
        body.dark .color-picker-section h3 {
            color: #eee !important;
        }
        body.dark .selected-color-info {
            color: #eee !important;
        }
        body.dark .custom-color-picker {
            background: #1d1d1d !important;
        }
        body.dark .color-picker-title {
            color: #eee !important;
        }
        body.dark .hex-display {
            color: #eee !important;
        }
        body.dark .hex-input-field {
            padding-left: var(--prefix-space) !important;
            color: #fff;
        }
        body.dark .hex-input-container {
            background: #2e2e2e;
            position: relative;
        }
        body.dark .hex-prefix {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: #000000;
            user-select: none;
            pointer-events: none;
            z-index: 2;
            color: #ffffff;
        }

        .ascii-title {
            /* 1) Monospace ensures each character is exactly the same width */
            font-family: monospace;
            /* 2) Preserve every space and line‐break exactly as you type them */
            white-space: pre;
            /* 3) Prevent it from wrapping mid‑line */
            overflow-x: auto;
            /* Optional styling to match your theme */
            color: inherit;
            text-align: center;
            margin: 0 auto;
            padding: 30px 20px 20px;
            line-height: 1em;      /* tighten the lines if you like */
            font-size: 1em;        /* adjust so it fits */
            position: static;
            min-width: 0;
            cursor: default
        }
        /* animate every character */
        .ascii-title span {
            display: inline-block;                      /* so animation-delay works per char */
            animation: wave 6s linear infinite;         /* 6s for a full cycle */
            animation-delay: calc(var(--col) * 0.1s);   /* stagger by 0.1s per character */
        }
        /* "paused" class will freeze all ascii‑title spans */
        .paused .ascii-title span {
            animation-play-state: paused !important;
        }
        /* cycle through hues for title */
        @keyframes wave {
            0%   { color: hsl(   0, 100%, 50%); }
            16%  { color: hsl(  60, 100%, 50%); }
            33%  { color: hsl( 120, 100%, 50%); }
            50%  { color: hsl( 180, 100%, 50%); }
            66%  { color: hsl( 240, 100%, 50%); }
            83%  { color: hsl( 300, 100%, 50%); }
            100% { color: hsl( 360, 100%, 50%); }
        }

        .color-display {
            width: 200px;
            height: 200px;
            margin: 20px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow)); /* same shadow as icons */
            justify-content: center;
            text-align: center;
            font-size: 18px;
            font-family: 'Press Start 2P', cursive;
            color: black;
            margin: 0;
        }
        .color-display.hidden {
            background: #f9f9f9 !important;
        }
        body.dark .color-display {           
            color: #ffffff;                  /* make sure your placeholder text is still readable */
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
        }
        body.dark .color-display.hidden {
            /* override the always‑black you had before */
            background: #2e2e2e !important;
        }
        body.dark .color-display.game-ended {
            /* reuse the dark‑mode text style */
            color: #ffffff;
            text-shadow:
                -1px -1px 0 #000000,
                1px -1px 0 #000000,
                -1px  1px 0 #000000,
                1px  1px 0 #000000;
        }
        body:not(.dark) .color-display.game-ended {
            /* reuse the dark‑mode text style */
            color: #eee;
            text-shadow:
                -1px -1px 0 #000000,
                1px -1px 0 #000000,
                -1px  1px 0 #000000,
                1px  1px 0 #000000;
        }
        .color-display.disabled {
            cursor: default !important;
            color: #787878 !important;
            pointer-events: none;
        }
        body.dark .color-display.disabled {
            color: #979797 !important;
        }
        .color-display.hidden:hover {
            background: #f1f1f1 !important; 
        }
        body.dark .color-display.hidden:hover {
            background: #373737 !important;
        }

        .game-info {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
        }

        .custom-color-picker {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(58, 36, 36, 0.1);
            font-family: 'Press Start 2P', cursive;
            position: relative;
            box-sizing: border-box;       /* include padding in the width calculation */
            width: 100%;                  /* fill up to… */
            max-width: 665px;             /* …your measured container width */
        }

        .color-picker-main {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .color-canvas {
            width: 200px;
            height: 200px;
            filter: none;
            box-shadow: 6px 6px 0 var(--icon-shadow);
            cursor: pointer;
            position: relative;
            background: linear-gradient(to right, #fff, #f00);
            flex-shrink: 0;
        }
        .color-canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent, #000);
        }
        .canvas-cursor {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.3);
        }

        .hue-slider {
            width: 20px;
            height: 200px;
            background: linear-gradient(to bottom, 
                #f00 0%, #ff0 16.66%, #0f0 33.33%, 
                #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100%);
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            filter: none;
            box-shadow: 6px 6px 0 var(--icon-shadow);
        }
        .hue-cursor {
            position: absolute;
            width: 20px;
            height: 16px;
            border: 2px solid white;
            transform: translate(-8%, -50%);
            left: 0px;
            pointer-events: none;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.3);
        }

        .color-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            height: 200px;
            justify-content: space-between;
        }

        .color-preview {
            width: 160px;
            flex: 1;
            height: 100px;
            margin: 0;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
        }

        .hex-input-container {
            --prefix-space: 24px;
            display: flex;
            align-items: center;
            width: 160px;
            height: 32px;
            background: #f9f9f9;
            border: none;
            position: relative;
            filter: drop-shadow(6px 6px 0 var(--icon-shadow));
            overflow: hidden;
        
        }

        .hex-prefix {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: #000000;
            user-select: none;
            pointer-events: none;
            z-index: 2;
        }

        .hex-input-field {
            padding-left: var(--prefix-space) !important;
            font-size: 12px;
            padding: 8px 4px;
            border: none;
            flex: 1;
            background: transparent;
            text-transform: uppercase;
            color: #000000;
            font-family: 'Press Start 2P', cursive;
            outline: none;
            padding-right: 32px;
        }

        .hex-copy-btn {
            background: none;
            border: none;
            padding: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            right: 4px;
            position: absolute;
        }
        .hex-copy-btn:hover .icon {
            color: var(--icon-color-hover);
        }

        .color-game-section {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .game-over {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
        }

        .restart-btn {
            font-size: 18px;
            padding: 12px 24px;
            border: none;
            background: #2196F3;
            color: white;
            cursor: pointer;
            margin: 10px;
        }

        .timer-bar {
            position: relative;
            width: 100%;
            max-width: 625px;
            height: 32px;
            background: rgba(143, 143, 143, 0.1);
            overflow: hidden;
            margin: 10px auto;
            box-shadow: 6px 6px 0 var(--icon-shadow);
        }
        /* the animated "fill" */
        .timer-fill {
            width: 100%;              /* starts full */
            height: 100%;
            background: #000000;       /* or pick any accent color */
            transition: width linear;  /* you'll set duration in JS */
        }
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: #ffffff;
            white-space: nowrap;
            z-index: 1;
        }
    
        /* === Wordle-style HEX grid === */
        .hex-grid-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        .hex-grid {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            grid-auto-rows: 50px;
            gap: 12px;
        }
        .hex-grid-row {
            display: grid;
            grid-template-columns: 32px repeat(6, 50px) 32px;
            gap: 12px;
            justify-content: center;
        }
        .grid-cell {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            user-select: none;
            text-transform: uppercase;
            filter: drop-shadow(4px 4px 0 var(--icon-shadow));
        }
        body.dark .grid-cell {
            background: #424242;
            color: #ffffff;
        }
        .grid-row-locked .grid-cell {
            pointer-events: none;
        }
        .grid-cell.correct {
            background: #4CAF50 !important;
            border-color: #4CAF50 !important;
            color: #fff !important;
        }
        .grid-cell.close {
            background: #FFC107 !important;
            border-color: #FFC107 !important;
            color: #fff !important;
        }
        .grid-cell.wrong {
            background: #f44336 !important;
            border-color: #f44336 !important;
            color: #fff !important;
        }
        .grid-current {
            outline: 2px dashed #000;
            outline-offset: 2px;
        }
        body.dark .grid-current {
            outline-color: #fff;
        }
        
        /* Row hashtag label (left of each row) */
        .row-label {
            width: 32px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Press Start 2P', cursive;
            font-size: 30px;
            user-select: none;
            visibility: hidden; /* only current row shows; completed rows stay visible once colored */
            filter: drop-shadow(4px 4px 0 var(--icon-shadow));
        }
        .row-label.visible {
            visibility: visible;
        }
        .row-label.colored {
            /* outline for readability across backgrounds */
            text-shadow:
                -1px -1px 0 #000,
                 1px -1px 0 #000,
                -1px  1px 0 #000,
                 1px  1px 0 #000;
        }
        /* Right-side paste action cell */
        .row-action {
            width: 32px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden; /* hidden by default; only current row shows */
        }
        .row-action.visible { visibility: visible; }

        .paste-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .paste-btn .icon {
            filter: drop-shadow(3px 3px 0 var(--icon-shadow));
            width: 30px;
            height: 30px;
        }
        .paste-btn:hover .icon {
            color: var(--icon-color-hover);
        }

        .hex-keyboard {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }
        .keyboard-row {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .key-btn {
            background: #000000;
            color: #ffffff;
            border: none;
            padding: 12px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            min-width: 40px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            text-transform: uppercase;
            filter: drop-shadow(4px 4px 0 var(--icon-shadow));
        }
        .key-btn:hover {
            background: #333333
        }
        .wide-key {
            flex: 1;
        }
        body.dark .key-btn {
            background: #ffffff;
            color: #000000;
        }
        body.dark .key-btn:hover {
            background: #dddddd;
        }
    </style>
</head>
<body>
    <!-- Icon Generation -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
        <symbol id="icon-anim" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="5" y="0" width="5" height="1"/><rect x="3" y="1" width="9" height="1"/><rect x="2" y="2" width="11" height="1"/><rect x="1" y="3" width="13" height="1"/><rect x="1" y="4" width="2" height="1"/><rect x="4" y="4" width="4" height="1"/><rect x="9" y="4" width="2" height="1"/><rect x="12" y="4" width="2" height="1"/><rect x="0" y="5" width="3" height="1"/><rect x="5" y="5" width="3" height="1"/><rect x="9" y="5" width="2" height="1"/><rect x="12" y="5" width="3" height="1"/><rect x="0" y="6" width="3" height="1"/><rect x="6" y="6" width="2" height="1"/><rect x="9" y="6" width="2" height="1"/><rect x="12" y="6" width="3" height="1"/><rect x="0" y="7" width="3" height="1"/><rect x="7" y="7" width="1" height="1"/><rect x="9" y="7" width="2" height="1"/><rect x="12" y="7" width="3" height="1"/><rect x="0" y="8" width="3" height="1"/><rect x="6" y="8" width="2" height="1"/><rect x="9" y="8" width="2" height="1"/><rect x="12" y="8" width="3" height="1"/><rect x="0" y="9" width="3" height="1"/><rect x="5" y="9" width="3" height="1"/><rect x="9" y="9" width="2" height="1"/><rect x="12" y="9" width="3" height="1"/><rect x="1" y="10" width="2" height="1"/><rect x="4" y="10" width="4" height="1"/><rect x="9" y="10" width="2" height="1"/><rect x="12" y="10" width="2" height="1"/><rect x="1" y="11" width="13" height="1"/><rect x="2" y="12" width="11" height="1"/><rect x="3" y="13" width="9" height="1"/><rect x="5" y="14" width="5" height="1"/>
            </g>
        </symbol>
        <symbol id="icon-question" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="3" y="0" width="9" height="1"/><rect x="2" y="1" width="11" height="1"/><rect x="1" y="2" width="13" height="1"/><rect x="1" y="3" width="13" height="1"/><rect x="1" y="4" width="5" height="1"/><rect x="10" y="4" width="4" height="1"/><rect x="2" y="5" width="3" height="1"/><rect x="10" y="5" width="4" height="1"/><rect x="7" y="6" width="7" height="1"/><rect x="6" y="7" width="7" height="1"/><rect x="5" y="8" width="7" height="1"/><rect x="5" y="9" width="5" height="1"/><rect x="5" y="10" width="5" height="1"/><rect x="5" y="12" width="5" height="1"/><rect x="5" y="13" width="5" height="1"/><rect x="6" y="14" width="3" height="1"/>
            </g>
        </symbol>
        <symbol id="icon-copy" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="1" y="1" width="10" height="1"/><rect x="1" y="2" width="10" height="1"/><rect x="1" y="3" width="2" height="1"/><rect x="9" y="3" width="2" height="1"/><rect x="12" y="3" width="2" height="1"/><rect x="1" y="4" width="2" height="1"/><rect x="9" y="4" width="2" height="1"/><rect x="12" y="4" width="2" height="1"/><rect x="1" y="5" width="2" height="1"/><rect x="9" y="5" width="2" height="1"/><rect x="12" y="5" width="2" height="1"/><rect x="1" y="6" width="2" height="1"/><rect x="9" y="6" width="2" height="1"/><rect x="12" y="6" width="2" height="1"/><rect x="1" y="7" width="2" height="1"/><rect x="9" y="7" width="2" height="1"/><rect x="12" y="7" width="2" height="1"/><rect x="1" y="8" width="2" height="1"/><rect x="9" y="8" width="2" height="1"/><rect x="12" y="8" width="2" height="1"/><rect x="1" y="9" width="10" height="1"/><rect x="12" y="9" width="2" height="1"/><rect x="1" y="10" width="10" height="1"/><rect x="12" y="10" width="2" height="1"/><rect x="12" y="11" width="2" height="1"/><rect x="3" y="12" width="11" height="1"/><rect x="3" y="13" width="11" height="1"/>
            </g>
        </symbol>
        <symbol id="icon-paste" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="6" y="0" width="3" height="1"/><rect x="5" y="1" width="2" height="1"/><rect x="8" y="1" width="2" height="1"/><rect x="3" y="2" width="9" height="1"/><rect x="2" y="3" width="2" height="1"/><rect x="11" y="3" width="2" height="1"/><rect x="2" y="4" width="1" height="1"/><rect x="12" y="4" width="1" height="1"/><rect x="2" y="5" width="1" height="1"/><rect x="4" y="5" width="7" height="1"/><rect x="12" y="5" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="12" y="6" width="1" height="1"/><rect x="2" y="7" width="1" height="1"/><rect x="4" y="7" width="7" height="1"/><rect x="12" y="7" width="1" height="1"/><rect x="2" y="8" width="1" height="1"/><rect x="12" y="8" width="1" height="1"/><rect x="2" y="9" width="1" height="1"/><rect x="4" y="9" width="7" height="1"/><rect x="12" y="9" width="1" height="1"/><rect x="2" y="10" width="1" height="1"/><rect x="12" y="10" width="1" height="1"/><rect x="2" y="11" width="1" height="1"/><rect x="4" y="11" width="7" height="1"/><rect x="12" y="11" width="1" height="1"/><rect x="2" y="12" width="1" height="1"/><rect x="12" y="12" width="1" height="1"/><rect x="2" y="13" width="2" height="1"/><rect x="11" y="13" width="2" height="1"/><rect x="3" y="14" width="9" height="1"/>
            </g>
        </symbol>
        <symbol id="icon-stats" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="8" y="0" width="3" height="1"/><rect x="8" y="1" width="3" height="1"/><rect x="8" y="2" width="3" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="3" height="1"/><rect x="4" y="4" width="3" height="1"/><rect x="8" y="4" width="3" height="1"/><rect x="4" y="5" width="3" height="1"/><rect x="8" y="5" width="3" height="1"/><rect x="4" y="6" width="3" height="1"/><rect x="8" y="6" width="3" height="1"/><rect x="0" y="7" width="3" height="1"/><rect x="4" y="7" width="3" height="1"/><rect x="8" y="7" width="3" height="1"/><rect x="0" y="8" width="3" height="1"/><rect x="4" y="8" width="3" height="1"/><rect x="8" y="8" width="3" height="1"/><rect x="0" y="9" width="3" height="1"/><rect x="4" y="9" width="3" height="1"/><rect x="8" y="9" width="3" height="1"/><rect x="12" y="9" width="3" height="1"/><rect x="0" y="10" width="3" height="1"/><rect x="4" y="10" width="3" height="1"/><rect x="8" y="10" width="3" height="1"/><rect x="12" y="10" width="3" height="1"/><rect x="0" y="11" width="3" height="1"/><rect x="4" y="11" width="3" height="1"/><rect x="8" y="11" width="3" height="1"/><rect x="12" y="11" width="3" height="1"/><rect x="0" y="12" width="3" height="1"/><rect x="4" y="12" width="3" height="1"/><rect x="8" y="12" width="3" height="1"/><rect x="12" y="12" width="3" height="1"/><rect x="0" y="13" width="3" height="1"/><rect x="4" y="13" width="3" height="1"/><rect x="8" y="13" width="3" height="1"/><rect x="12" y="13" width="3" height="1"/><rect x="0" y="14" width="3" height="1"/><rect x="4" y="14" width="3" height="1"/><rect x="8" y="14" width="3" height="1"/><rect x="12" y="14" width="3" height="1"/>
            </g>
        </symbol>
        <symbol id="icon-darkmode" viewBox="0 0 15 15">
            <g fill="currentColor">
                <rect x="5" y="0" width="3" height="1"/><rect x="3" y="1" width="3" height="1"/><rect x="2" y="2" width="3" height="1"/><rect x="1" y="3" width="4" height="1"/><rect x="1" y="4" width="3" height="1"/><rect x="0" y="5" width="4" height="1"/><rect x="0" y="6" width="4" height="1"/><rect x="0" y="7" width="5" height="1"/><rect x="14" y="7" width="1" height="1"/><rect x="0" y="8" width="5" height="1"/><rect x="14" y="8" width="1" height="1"/><rect x="0" y="9" width="6" height="1"/><rect x="13" y="9" width="2" height="1"/><rect x="1" y="10" width="7" height="1"/><rect x="11" y="10" width="3" height="1"/><rect x="1" y="11" width="13" height="1"/><rect x="2" y="12" width="11" height="1"/><rect x="3" y="13" width="9" height="1"/><rect x="5" y="14" width="5" height="1"/>
            </g>
        </symbol>
    </svg>
    <!-- /Icon Generation -->

    <div class="layout-container">
        <header class="game-header">
            <!-- mode selector buttons -->
            <div class="mode-container">
                <button class="mode-btn">Daily</button>
                <button class="mode-btn">Unlimited</button>
            </div>

<pre class="ascii-title">
██╗  ██╗███████╗██╗  ██╗ ██████╗ ██╗   ██╗███████╗███████╗███████╗██████╗ 
██║  ██║██╔════╝╚██╗██╔╝██╔════╝ ██║   ██║██╔════╝██╔════╝██╔════╝██╔══██╗
███████║█████╗   ╚███╔╝ ██║  ███╗██║   ██║█████╗  ███████╗███████╗██████╔╝
██╔══██║██╔══╝   ██╔██╗ ██║   ██║██║   ██║██╔══╝  ╚════██║╚════██║██╔══██╗
██║  ██║███████╗██╔╝ ██╗╚██████╔╝╚██████╔╝███████╗███████║███████║██║  ██║
╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚══════╝╚═╝  ╚═╝
</pre>

            <div class="top-controls">

                <!-- Help / Instructions -->
                <button id="infoButton" class="icon-btn" aria-label="Show instructions"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-question"></use></svg></button>

                <!-- Stats (if you have a stats panel) -->
                <button id="statsButton" class="icon-btn" aria-label="Show stats"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-stats"></use></svg></button>

                <!-- Animation toggle -->
                <button id="toggleAnimations" class="icon-btn" aria-label="Pause animations"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-anim"></use></svg></button>

                <!-- Dark‑mode toggle -->
                <button id="darkModeToggle" class="icon-btn" aria-label="Toggle dark mode"><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-darkmode"></use></svg></button>
            </div>
        </header>
        
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const pre   = document.querySelector(".ascii-title");
                const lines = pre.textContent.split("\n");
                pre.innerHTML = ""; // clear out the raw ASCII

                lines.forEach((line, row) => {
                    Array.from(line).forEach((ch, col) => {
                        const span = document.createElement("span");
                        span.textContent = ch;
                        // keep only the column index for the RGB wave
                        span.style.setProperty("--col", col);
                        pre.appendChild(span);
                    });
                    // re–insert a newline so your <pre> stays multi-line
                    if (row < lines.length - 1) {
                        pre.appendChild(document.createTextNode("\n"));
                    }
                });
            });
        </script>

        <div class="game-container">   
            <div class="color-game-section">
                <div class="custom-color-picker">
                    <div class="color-display hidden" id="colorDisplay">
                        Click to reveal color!
                    </div>
                    
                    <div class="color-picker-main">                
                        <div class="color-canvas" id="colorCanvas">
                            <div class="canvas-cursor" id="canvasCursor"></div>
                        </div>
                        
                        <div class="hue-slider" id="hueSlider">
                            <div class="hue-cursor" id="hueCursor"></div>
                        </div>
                        
                        <div class="color-controls">
                            <div class="color-preview" id="colorPreview"></div>
                            
                            <div class="hex-input-container">
                                <span class="hex-prefix">#</span>
                                <input type="text" id="hexInputField" class="hex-input-field" value="FF5733" maxlength="6">
                                <button id="copyBtn" class="hex-copy-btn" aria-label="Copy hex code"><svg class="icon icon--sm" viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-copy"></use></svg></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timer-bar" id="timerBar">
                <div class="timer-fill" id="timerFill"></div>
                <div class="timer-text" id="timerText">Color reveal will be visible for 1.0s</div>
            </div>

            <div class="input-section">
                <div class="hex-grid-wrapper">
                    <div id="hexGrid" class="hex-grid" aria-label="Hex guess grid"></div>
                    <div style="font-family: 'Press Start 2P', cursive; font-size: 12px;">
                        <div id="hexKeyboard" class="hex-keyboard" aria-label="On-screen hex keyboard">
                            <div class="keyboard-row">
                                <button class="key-btn" data-key="0">0</button>
                                <button class="key-btn" data-key="1">1</button>
                                <button class="key-btn" data-key="2">2</button>
                                <button class="key-btn" data-key="3">3</button>
                                <button class="key-btn" data-key="4">4</button>
                                <button class="key-btn" data-key="5">5</button>
                                <button class="key-btn" data-key="6">6</button>
                                <button class="key-btn" data-key="7">7</button>
                                <button class="key-btn" data-key="8">8</button>
                                <button class="key-btn" data-key="9">9</button>
                            </div>
                            <div class="keyboard-row">
                                <button class="key-btn wide-key" data-action="enter">ENTER</button>
                                <button class="key-btn" data-key="A">A</button>
                                <button class="key-btn" data-key="B">B</button>
                                <button class="key-btn" data-key="C">C</button>
                                <button class="key-btn" data-key="D">D</button>
                                <button class="key-btn" data-key="E">E</button>
                                <button class="key-btn" data-key="F">F</button>
                                <button class="key-btn wide-key" data-action="backspace">DEL</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="guesses-container" id="guessesContainer"></div>

            <div id="gameOver" class="game-over" style="display: none;">
                <h2 id="gameResult"></h2>
                <p id="correctAnswer"></p>
                <button id="restartBtn" class="restart-btn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        class HexColorWordle {
            constructor() {
                this.targetColor = this.generateRandomColor();
                this.currentAttempt = 1;
                this.maxAttempts = 6;
                this.gameOver = false;
                this.colorVisible = false;
                this.hasRevealedThisAttempt = false;
                this.baseDuration = 1000; // 1 second for first attempt
                
                this.initializeElements();
                this.setupEventListeners();
                this.updateColorPicker();
                this.initializeTimerText(); // Initialize the timer text
                this.buildGrid();
                this.setupOnScreenKeyboard();
                // keyboard input
                document.addEventListener('keydown', this.handleKeydown)

                // Info button listener
                this.infoBtn = document.getElementById('infoButton');
                this.infoBtn.addEventListener('click', () => {
                  alert(
                    '🎨 Hex Color Wordle Instructions:\n\n' +
                    '1) Click the square to briefly reveal the target color.\n' +
                    '2) Enter your 6‑digit HEX guess and press Submit.\n' +
                    '3) Green = correct digit, Yellow = off by 1, Red = wrong.\n' +
                    '4) You have 6 attempts – good luck!'
                  );
                });
            }

            initializeElements() {
                this.colorDisplay = document.getElementById('colorDisplay');
                                                this.guessesContainer = document.getElementById('guessesContainer');
                this.gameOverDiv = document.getElementById('gameOver');
                this.gameResult = document.getElementById('gameResult');
                this.correctAnswer = document.getElementById('correctAnswer');
                this.restartBtn = document.getElementById('restartBtn');
                this.timerText = document.getElementById('timerText');
                this.timerBar  = document.getElementById('timerBar');
                this.timerFill = document.getElementById('timerFill');
                
                // Custom color picker elements
                this.colorCanvas = document.getElementById('colorCanvas');
                this.canvasCursor = document.getElementById('canvasCursor');
                this.hueSlider = document.getElementById('hueSlider');
                this.hueCursor = document.getElementById('hueCursor');
                this.colorPreview = document.getElementById('colorPreview');
                this.hexInputField = document.getElementById('hexInputField');
                this.copyBtn = document.getElementById('copyBtn');
            }
            
            buildGrid() {
                // build 6x6 grid
                this.gridRows = 6;
                this.gridCols = 6;
                this.currentRow = 0;
                this.currentCol = 0;
                this.gridEl = document.getElementById('hexGrid');
                this.gridEl.innerHTML = '';
                this.gridCellRefs = [];

                this.rowLabels = [];
                this.rowActions = [];
                this.pasteButtons = [];
                for (let r = 0; r < this.gridRows; r++) {
                    const rowEl = document.createElement('div');
                    rowEl.className = 'hex-grid-row';
                    // left hashtag label
                    const label = document.createElement('div');
                    label.className = 'row-label';
                    label.textContent = '#';
                    rowEl.appendChild(label);
                    this.rowLabels.push(label);
                    const rowCells = [];
                    for (let c = 0; c < this.gridCols; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        rowEl.appendChild(cell);
                        rowCells.push(cell);
                    }

                    // right-side paste action
                    const action = document.createElement('div');
                    action.className = 'row-action';
                    const pasteBtn = document.createElement('button');
                    pasteBtn.type = 'button';
                    pasteBtn.className = 'paste-btn';
                    const svgNS = 'http://www.w3.org/2000/svg';
                    const pasteSvg = document.createElementNS(svgNS, 'svg');
                    pasteSvg.setAttribute('class', 'icon icon--sm');
                    pasteSvg.setAttribute('viewBox', '0 0 15 15');
                    const use = document.createElementNS(svgNS, 'use');
                    use.setAttribute('href', '#icon-paste');
                    pasteSvg.appendChild(use);
                    pasteBtn.appendChild(pasteSvg);
                    action.appendChild(pasteBtn);
                    rowEl.appendChild(action);
                    this.rowActions.push(action);
                    this.pasteButtons.push(pasteBtn);

                    this.gridEl.appendChild(rowEl);
                    this.gridCellRefs.push(rowCells);
                }
                this.updateCaret();
                this.updateRowLabels();
                this.updatePasteAction();
                this.attachPasteHandlers();
                // focus handling: click grid focuses keyboard capture
                this.gridEl.tabIndex = 0;
                this.gridEl.addEventListener('focus', () => { this.gridFocused = true; });
                this.gridEl.addEventListener('blur',  () => { this.gridFocused = false; });
                this.gridEl.focus();
            }

            updateCaret() {
                // highlight current cell
                this.gridCellRefs.flat().forEach(cell => cell.classList.remove('grid-current'));
                if (this.currentRow < this.gridRows && this.currentCol < this.gridCols) {
                    this.gridCellRefs[this.currentRow][this.currentCol].classList.add('grid-current');
                }
            }

            handleKeydown = (e) => {
                if (this.gameOver) return;
                // accept input anywhere; if user is typing in another field, ignore
                const active = document.activeElement;
                const isTypingInInput = active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA');
                if (isTypingInInput && active !== this.gridEl) return;

                const key = e.key.toUpperCase();
                if (/^[0-9A-F]$/.test(key)) {
                    if (this.currentCol < this.gridCols) {
                        this.setCell(this.currentRow, this.currentCol, key);
                        this.currentCol++;
                        if (this.currentCol >= this.gridCols) this.currentCol = this.gridCols;
                        this.updateCaret();
                    }
                    e.preventDefault();
                } else if (e.key === 'Backspace') {
                    if (this.currentCol > 0) {
                        this.currentCol--;
                        this.setCell(this.currentRow, this.currentCol, '');
                        this.updateCaret();
                    }
                    e.preventDefault();
                } else if (e.key === 'Enter') {
                    // Block submitting while the color is revealed & timer is running
                    if (this.colorVisible) { e.preventDefault(); return; }
                    this.submitGuess();
                    e.preventDefault();
                }
            }

            setCell(r, c, ch) {
                const cell = this.gridCellRefs[r][c];
                cell.textContent = ch;
                if (ch) cell.classList.add('filled')
                else cell.classList.remove('filled');
            }

            getCurrentGuess() {
                const chars = [];
                for (let c = 0; c < this.gridCols; c++) {
                    chars.push(this.gridCellRefs[this.currentRow][c].textContent || '');
                }
                return chars.join('');
            }

            lockCurrentRow() {
                const rowCells = this.gridCellRefs[this.currentRow];
                rowCells.forEach(cell => cell.parentElement.classList.add('grid-row-locked'));
            }

            clearCurrentRowBuffer() {
                // nothing to clear visually; advance to next row
                this.currentRow++;
                this.currentCol = 0;
                this.updateCaret();
                this.updateRowLabels();
                this.updatePasteAction();
            }


            
            updateRowLabels() {
                // Hide non-colored labels
                this.rowLabels.forEach((lbl) => {
                    if (!lbl.classList.contains('colored')) {
                        lbl.classList.remove('visible');
                    }
                });
                // Show current row's label
                if (this.currentRow < this.rowLabels.length) {
                    const lbl = this.rowLabels[this.currentRow];
                    lbl.classList.add('visible');
                    lbl.style.color = ''; // reset to default
                }
            }
            colorizeRowLabel(rowIndex, hex) {
                if (rowIndex < 0 || rowIndex >= this.rowLabels.length) return;
                const lbl = this.rowLabels[rowIndex];
                lbl.classList.add('visible', 'colored');
                lbl.style.color = `#${hex}`;
            }
            updatePasteAction() {
                this.rowActions.forEach((el, idx) => {
                    el.classList.toggle('visible', idx === this.currentRow);
                });
            }
            attachPasteHandlers() {
                this.pasteButtons.forEach((btn, idx) => {
                    btn.onclick = async () => {
                        if (this.gameOver || idx !== this.currentRow) return;
                        try {
                            const text = await navigator.clipboard.readText();
                            const hex = (text || '').replace(/[^0-9A-Fa-f]/g, '').toUpperCase().slice(0, 6);
                            if (!hex) return;
                            for (let i = 0; i < this.gridCols; i++) {
                                const ch = hex[i] || ''; this.setCell(this.currentRow, i, ch);
                            }
                        } catch (e) {
                            alert('Clipboard access failed. Try HTTPS and grant permission.');
                        }
                    };
                });
            }

            initializeTimerText() {
                // Set the initial timer text to show the duration for the current attempt
                const duration = this.baseDuration + (this.currentAttempt - 1) * 500;
                const seconds = (duration / 1000).toFixed(1);
                this.timerText.textContent = `Color reveal will be visible for ${seconds}s`;
            }


            setupOnScreenKeyboard() {
                this.keyboardEl = document.getElementById('hexKeyboard');
                if (!this.keyboardEl) return;
                this.keyboardEl.addEventListener('click', (e) => {
                    if (this.gameOver) return;
                    const btn = e.target.closest('.key-btn');
                    if (!btn) return;
                    const action = btn.dataset.action || '';
                    const key = (btn.dataset.key || '').toUpperCase();
                    
                    if (action === 'enter') {
                        // Block submitting while the color is revealed & timer is running
                        if (this.colorVisible) return;
                        this.submitGuess();
                        return;
                    }
                    if (action === 'backspace') {
                        if (this.currentCol > 0) {
                            this.currentCol--;
                            this.setCell(this.currentRow, this.currentCol, '');
                            this.updateCaret();
                        }
                        return;
                    }
                    if (/^[0-9A-F]$/.test(key)) {
                        if (this.currentCol < this.gridCols) {
                            this.setCell(this.currentRow, this.currentCol, key);
                            this.currentCol = Math.min(this.currentCol + 1, this.gridCols);
                            this.updateCaret();
                        }
                    }
                });
            }

            setupEventListeners() {
                this.colorDisplay.addEventListener('click', () => this.showColor());
                
                                this.restartBtn.addEventListener('click', () => this.restartGame());
                
                // Custom color picker event listeners
                this.setupColorPickerListeners();
            }
            
            setupColorPickerListeners() {
                // Canvas click/drag
                let isDraggingCanvas = false;
                this.colorCanvas.addEventListener('mousedown', (e) => {
                    isDraggingCanvas = true;
                    this.updateCanvasPosition(e);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDraggingCanvas) {
                        this.updateCanvasPosition(e);
                    }
                    if (isDraggingHue) {
                        this.updateHuePosition(e);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDraggingCanvas = false;
                    isDraggingHue = false;
                });
                
                // Hue slider click/drag
                let isDraggingHue = false;
                this.hueSlider.addEventListener('mousedown', (e) => {
                    isDraggingHue = true;
                    this.updateHuePosition(e);
                });

                // 1) Block bad keys _before_ they ever enter the field
                this.hexInputField.addEventListener("keydown", e => {
                    // allow navigation / copy-paste etc.
                    if (e.metaKey || e.ctrlKey || e.altKey) return;
                    // only block single‐char keys that aren't 0–9 or A–F
                    if (e.key.length === 1 && !/^[0-9A-Fa-f]$/.test(e.key)) {
                        e.preventDefault();
                    }
                });

                // Hex input field
                this.hexInputField.addEventListener('input', (e) => {
                    const input = e.target;
                    // save where the caret was
                    const pos = input.selectionStart;
                    // filter + uppercase
                    const filtered = input.value
                        .replace(/[^0-9A-Fa-f]/g, '')
                        .toUpperCase();
                    input.value = filtered;
                    // put the caret back where it was
                    input.setSelectionRange(pos, pos);

                    if (filtered.length === 6) {
                        this.updateFromHex(filtered);
                    }
                });
                
                // Copy button
                this.copyBtn.addEventListener('click', () => {
                    const hexValue = (this.hexInputField.value || '')
                    .toUpperCase()
                    .replace(/[^0-9A-F]/g, '')
                    .slice(0, 6);

                    navigator.clipboard.writeText(hexValue).catch(() => {
                        // Fallback for older browsers (execCommand is deprecated but works on old Safari)
                        const ta = document.createElement('textarea');
                        ta.value = hexValue;
                        document.body.appendChild(ta);
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                    });
                });
                
                // Initialize color picker
                this.currentHue = 0;
                this.currentSaturation = 1;
                this.currentValue = 1;
                this.updateColorPicker();
            }
            
            updateCanvasPosition(e) {
                const rect = this.colorCanvas.getBoundingClientRect();
                const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));
                const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
                
                this.canvasCursor.style.left = x + 'px';
                this.canvasCursor.style.top = y + 'px';
                
                // Calculate saturation and brightness (value)
                this.currentSaturation = x / rect.width;
                this.currentValue = 1 - (y / rect.height);
                
                this.updateColorFromHSV();
            }
            
            updateHuePosition(e) {
                const rect = this.hueSlider.getBoundingClientRect();
                const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
                
                this.hueCursor.style.top = y + 'px';
                
                // Calculate hue (0-360)
                this.currentHue = (y / rect.height) * 360;
                
                // Update canvas background
                const hueColor = `hsl(${this.currentHue}, 100%, 50%)`;
                this.colorCanvas.style.background = `linear-gradient(to right, #fff, ${hueColor})`;
                
                this.updateColorFromHSV();
            }
            
            updateColorFromHSV() {
                // Convert HSV to RGB
                const h = this.currentHue / 360;
                const s = this.currentSaturation;
                const v = this.currentValue;
                
                const c = v * s;
                const x = c * (1 - Math.abs((h * 6) % 2 - 1));
                const m = v - c;
                
                let r, g, b;
                if (h < 1/6) {
                    r = c; g = x; b = 0;
                } else if (h < 2/6) {
                    r = x; g = c; b = 0;
                } else if (h < 3/6) {
                    r = 0; g = c; b = x;
                } else if (h < 4/6) {
                    r = 0; g = x; b = c;
                } else if (h < 5/6) {
                    r = x; g = 0; b = c;
                } else {
                    r = c; g = 0; b = x;
                }
                
                r = (r + m);
                g = (g + m);
                b = (b + m);
                
                // Convert to 0-255 range
                r = Math.round(r * 255);
                g = Math.round(g * 255);
                b = Math.round(b * 255);
                
                // Convert to hex
                const hex = ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
                
                // Update UI
                this.colorPreview.style.backgroundColor = `#${hex}`;
                this.hexInputField.value = hex;
            }
            
            updateFromHex(hex) {
                // Convert hex to RGB
                const r = parseInt(hex.substr(0, 2), 16) / 255;
                const g = parseInt(hex.substr(2, 2), 16) / 255;
                const b = parseInt(hex.substr(4, 2), 16) / 255;
                
                // Convert RGB to HSV
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const delta = max - min;
                
                let h, s, v = max;
                
                if (delta === 0) {
                    h = 0;
                    s = 0;
                } else {
                    s = delta / max;
                    
                    switch (max) {
                        case r: h = (g - b) / delta + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / delta + 2; break;
                        case b: h = (r - g) / delta + 4; break;
                    }
                    h /= 6;
                }
                
                // Update internal state
                this.currentHue = h * 360;
                this.currentSaturation = s;
                this.currentValue = v;
                
                // Update UI positions
                const huePos = (this.currentHue / 360) * this.hueSlider.offsetHeight;
                this.hueCursor.style.top = huePos + 'px';
                
                const canvasX = this.currentSaturation * this.colorCanvas.offsetWidth;
                const canvasY = (1 - this.currentValue) * this.colorCanvas.offsetHeight;
                this.canvasCursor.style.left = canvasX + 'px';
                this.canvasCursor.style.top = canvasY + 'px';
                
                // Update canvas background
                const hueColor = `hsl(${this.currentHue}, 100%, 50%)`;
                this.colorCanvas.style.background = `linear-gradient(to right, #fff, ${hueColor})`;
                
                // Update preview
                this.colorPreview.style.backgroundColor = `#${hex}`;
            }

            generateRandomColor() {
                return Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0').toUpperCase();
            }

            showColor() {
                if (this.colorVisible || this.gameOver || this.hasRevealedThisAttempt) return;
                
                this.colorVisible = true;
                this.hasRevealedThisAttempt = true;
                this.colorDisplay.style.background = `#${this.targetColor}`;
                this.colorDisplay.classList.remove('hidden');
                this.colorDisplay.textContent = '';
                this.colorDisplay.classList.add('disabled');
                
                // Calculate duration: increases with each attempt
                const duration = this.baseDuration + (this.currentAttempt - 1) * 500;
                
                // Clear timer text after clicking
                this.timerText.textContent = '';
                
                this.startTimer(duration);
                
                setTimeout(() => {
                    if (!this.gameOver) {
                        this.colorDisplay.classList.add('hidden');
                        this.colorDisplay.textContent = 'Submit a guess to reveal again!';
                        this.colorVisible = false;
                        // Keep timer bar empty after color is hidden
                        this.timerFill.style.transition = '';
                        this.timerFill.style.width = '0%';
                    }
                }, duration);
            }

            startTimer(duration) {
                this.timerFill.style.transition = `width ${duration}ms linear`;
                requestAnimationFrame(() => {
                    this.timerFill.style.width = '0%';
                });
            }

            submitGuess() {
                if (this.gameOver) return;
                // Do not allow guesses while the reveal timer is active
                if (this.colorVisible) return;
                const guess = this.getCurrentGuess();
                if (guess.length !== 6 || !/^[0-9A-F]{6}$/.test(guess)) {
                    alert('Please enter a valid 6-digit hex color (0-9, A-F)');
                    return;
                }

                // lock the row UI
                this.lockCurrentRow();
                
                // Reset reveal ability for next attempt
                this.hasRevealedThisAttempt = false;
                this.colorDisplay.classList.remove('disabled');
                if (!this.colorVisible) {
                    this.colorDisplay.textContent = 'Click to reveal color!';
                }
                
                this.processGuess(guess);
                this.colorizeRowLabel(this.currentRow, guess);
                this.clearCurrentRowBuffer();

                if (guess === this.targetColor) {
                    this.endGame(true);
                } else if (this.currentAttempt >= this.maxAttempts) {
                    this.endGame(false);
                } else {
                    this.currentAttempt++;
                    if (this.currentAttemptSpan) {
                        this.currentAttemptSpan.textContent = this.currentAttempt;
                    }
                    
                    // Update timer text for the new attempt
                    const duration = this.baseDuration + (this.currentAttempt - 1) * 500;
                    const seconds = (duration / 1000).toFixed(1);
                    this.timerText.textContent = `Color reveal will be visible for ${seconds}s`;
                    
                    // Refill the timer bar for next attempt
                    this.timerFill.style.transition = '';
                    this.timerFill.style.width = '100%';
                }
            }

            processGuess(guess) {
                const rowCells = this.gridCellRefs[this.currentRow];
                for (let i = 0; i < 6; i++) {
                    const cell = rowCells[i];
                    // clear any old status classes
                    cell.classList.remove('correct','close','wrong');
                    if (guess[i] === this.targetColor[i]) {
                        cell.classList.add('correct');
                    } else if (this.isClose(guess[i], this.targetColor[i])) {
                        cell.classList.add('close');
                    } else {
                        cell.classList.add('wrong');
                    }
                }
            }

            isClose(guessChar, targetChar) {
                const guessValue = parseInt(guessChar, 16);
                const targetValue = parseInt(targetChar, 16);
                return Math.abs(guessValue - targetValue) <= 1;
            }

            endGame(won) {
                this.gameOver = true;
                this.colorDisplay.style.background = `#${this.targetColor}`;
                this.colorDisplay.classList.remove('hidden');
                this.colorDisplay.textContent = `#${this.targetColor}`;
                this.colorDisplay.classList.add('game-ended');
                this.timerText.textContent = '';
                
                this.gameResult.textContent = won ? '🎉 Congratulations! You won!' : '😔 Game Over!';
                this.correctAnswer.textContent = `The correct color was: #${this.targetColor}`;
                this.gameOverDiv.style.display = 'block';
                
                
            }

            updateColorPicker() {
                // Initialize with default color
                this.updateFromHex('FF5733');
            }

            restartGame() {
                this.targetColor = this.generateRandomColor();
                this.currentAttempt = 1;
                this.gameOver = false;
                this.colorVisible = false;
                this.hasRevealedThisAttempt = false;
                
                this.colorDisplay.classList.add('hidden');
                this.colorDisplay.classList.remove('disabled');
                this.colorDisplay.textContent = 'Click to reveal color!';
                if (this.currentAttemptSpan) {
                    this.currentAttemptSpan.textContent = '1';
                }
                this.guessesContainer.innerHTML = '';
                this.gameOverDiv.style.display = 'none';
                
                this.colorDisplay.classList.remove('game-ended');
                
                // Rebuild grid
                this.buildGrid();
                this.updateRowLabels();
                this.updatePasteAction();
                this.setupOnScreenKeyboard();
                
                // Reset timer bar to full for new game
                this.timerFill.style.transition = '';
                this.timerFill.style.width = '100%';
                
                // Initialize timer text for new game
                this.initializeTimerText();
            }
        }

        // Start the game when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            // 1) Start the game
            new HexColorWordle();

            // Dark mode toggle (no icon swapping needed with SVG)
            const darkModeBtn  = document.getElementById("darkModeToggle");
            darkModeBtn.addEventListener("click", () => {
                const isDark = document.body.classList.toggle("dark");
                darkModeBtn.setAttribute(
                    "aria-label",
                    isDark ? "Switch to light mode" : "Switch to dark mode"
                );
            });

            // Animation pause/resume
            const toggleAnimationsBtn = document.getElementById("toggleAnimations");
            toggleAnimationsBtn.addEventListener("click", () => {
                const isPaused = document.body.classList.toggle("paused");
                toggleAnimationsBtn.setAttribute(
                    "aria-label",
                    isPaused ? "Resume animations" : "Pause animations"
                );
            });
        });
    </script>
</body>
</html>
